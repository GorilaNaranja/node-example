<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />

    <title>Chat Example</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font: 13px Helvetica, Arial;
      }
    </style>
  </head>

  <body>
    <div>
      <img
        id="kanye"
        style="position:absolute; width: 50%; z-index: 10; visibility: hidden;"
        src="data:image/jpeg;base64,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"
      />
    </div>
    <div class="row">
      <div class="col-9">
        <div class="card m-3">
          <h3 class="card-header">CHAT</h3>
          <div class="card-body">
            <ul id="messages"></ul>
          </div>
          <div class="card-footer">
            <form class="form-inline">
              <input
                id="m"
                class="form-control"
                autocomplete="off"
                placeholder="Message"
              />
              <div class="input-group-append">
                <button class="btn btn-dark mx-3">Send</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card m-3">
          <h3 class="card-header">ONLINE</h3>
          <div class="card-body">
            <ul id="connected-users"></ul>
          </div>
          <div class="card-footer">
            <small class="text-muted">users online in this room</small>
          </div>
        </div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      function activateKanye() {
        const image = document.getElementById("kanye");
        image.style.visibility = "visible";

        image.animate(
          [
            { transform: "translateX(-200%)" },
            { transform: "translateX(200%)" }
          ],
          {
            duration: 4000,
            iterations: 1
          }
        );

        setTimeout(function() {
          image.style.visibility = "hidden";
        }, 3900);
      }

      $(function() {
        const host = window.location.hostname;
        const user = JSON.parse(window.localStorage.getItem("user"));
        console.log(host);

        const options = {
          transportOptions: {
            //polling: {
            //  extraHeaders: {
            //    Authorization: `${user.token}`
            //  }
            //}
          }
        };

        const socket = io(host, options);
        const room = window.location.pathname.split("/room/")[1];
        const element = '<div class="shadow p-3 mb-2 bg-white rounded">';

        socket.emit("joinRoom", room, user);
        socket.emit("requestMessages", room);

        $("form").submit(function(e) {
          e.preventDefault();
          const msg = $("#m").val();
          if (msg) socket.emit("createMsg", msg, room);
          $("#m").val("");
          return false;
        });

        socket.on("usersConnected", users => {
          $("#connected-users").empty();
          users.forEach(user => {
            $("#connected-users").append($(element).text(user.name));
          });
        });

        socket.on("activateKaney", msg => {
          activateKanye();
        });

        socket.on("createMsg", (data, roomId) => {
          const hours = new Date(data.date).getHours();
          const minutes = new Date(data.date).getMinutes();

          $("#messages").append(
            $(element).text(
              `[${hours}:${minutes}] ${data.user}: ${data.message}`
            )
          );
        });

        socket.on("loadMessages", messages => {
          messages.forEach(data => {
            const hours = new Date(data.date).getHours();
            const minutes = new Date(data.date).getMinutes();

            $("#messages").append(
              $(element).text(
                `[${hours}:${minutes}] ${data.user}: ${data.message}`
              )
            );
          });
        });
      });
    </script>
  </body>
</html>
